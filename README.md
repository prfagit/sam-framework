# 🤖 SAM Framework

<div align="center">

```
⠀⠀⠀⢘⠀⡂⢠⠆⠀⡰⠀⡀⢀⣠⣶⣦⣶⣶⣶⣶⣾⣿⣿⡿⢀⠈⢐⠈⠀⠀
⠀⠀⠀⡁⢄⡀⣞⡇⢰⠃⣼⣇⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⠛⣰⣻⡀⢸⠀⠀⠀
⠀⠀⠀⣠⠁⣛⣽⣇⠘⢸⣿⣿⣷⣾⣿⣿⣿⣿⣿⣿⠟⢡⣾⣿⢿⡇⠀⡃⠀⠀
⠀⠀⢀⠐⠀⢳⣿⡯⡞⣾⣿⣿⣿⣿⣿⣿⢿⣿⠟⢁⣴⣿⣿⣿⡜⢷⠀⢘⠄⠀
⠀⠀⠀⡊⢸⡆⠙⠛⡵⣿⣿⣿⣿⣿⡿⠤⠛⣠⣴⣿⣿⠿⣟⣟⠟⢿⡆⢳⠀⠀
⠀⠀⠘⡁⢸⡾⠁⠀⠀⠀⠀⠉⠉⠉⠈⣠⡌⢁⠄⡛⠡⠉⠍⠙⢳⢾⠁⢸⠀⠀
⠀⠀⠀⠂⢨⠌⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣷⡎⠙⢬⣳⣪⡯⢜⣷⢸⠂⡈⠄⠀
⠀⠀⠀⠆⣰⢣⠀⠀⠀⠀⠀⠀⠀⣴⣿⣾⣷⢿⢻⣅⣌⡯⢛⣿⣿⡞⠠⡁⠂⠀
⠀⠀⠀⠄⢲⢉⡀⠀⠀⢀⡠⠤⠼⣇⣳⣿⣿⣟⡜⣿⣿⣿⣿⣿⣿⡇⠸⠡⠀⠀
⠀⠀⡀⠁⠹⠃⢀⡀⣿⡹⠗⢀⠛⠥⣺⣿⣿⡝⢹⣸⣿⣿⣿⣿⡏⠠⠰⠈⠐⠀
⠠⠈⠀⠄⣀⠀⠀⠸⠻⠦⠀⠀⠀⠀⠀⠉⠐⠀⠘⠻⢹⣿⡿⠃⠀⡀⠕⣈⠡⡄
⠀⠀⣴⡀⣬⠁⠀⠀⡁⠂⠀⣀⣀⠔⠌⠤⣀⡀⠀⠀⡈⢸⠪⠀⠀⡌⠤⠈⡀⣠
⠀⠀⣿⣿⣾⡇⠀⠀⠀⣴⢫⣾⠃⠠⢰⣶⣴⠶⣿⣦⠀⠀⠀⢄⣂⠀⠀⠰⠀⠙
⠀⠀⠉⠛⠛⠀⢀⣴⣿⢗⡟⠡⣄⣀⡀⠀⢀⣤⠞⡅⠀⠁⠀⡾⠀⠀⠠⡗⠀⢀
⠀⠀⠀⠀⠀⣴⡿⢋⠔⠃⠀⠀⠍⠙⠉⠈⠑⠁⠂⠀⠀⠀⡡⡁⣠⡼⣸⠅⠀⠘
⠀⠀⠀⣼⠛⢡⠔⠁⠐⣆⠀⠀⠀⠀⠀⠀⠀⠀⠁⢀⡔⡞⢛⣿⡿⠃⠏⠀⠀⢠
⠀⠀⠀⠈⠗⠀⠀⠀⠀⠘⣷⣀⢀⣀⣀⠀⡀⢀⣌⡧⠂⠀⡞⠛⡟⠀⠀⠀⡠⠜
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠓⠈⠙⠙⠋⠉⠁⠀⠀⠀⠀⠀⠀⠀⡂⠠⠤⢶
```

**Solana Agent Middleware** - Production-ready AI agent framework for blockchain operations

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![PyPI](https://img.shields.io/pypi/v/sam-framework)](https://pypi.org/project/sam-framework/)
[![Tests](https://img.shields.io/badge/Tests-Passing-green.svg)](tests/)

*Framework for building autonomous AI agents that interact with the Solana blockchain ecosystem*

</div>

---

## 📋 Table of Contents

- [🔍 Overview](#-overview)
- [⚡ Key Features](#-key-features)
- [🚀 Quick Start](#-quick-start)
- [🛠️ Tool Ecosystem](#-tool-ecosystem)
- [🏗️ Architecture](#-architecture)
- [🔧 Configuration](#-configuration)
- [🔌 Plugin System](#-plugin-system)
- [🛡️ Security](#-security)
- [📊 Development](#-development)
- [📚 Documentation](#-documentation)

---

## 🔍 Overview

SAM Framework provides a production-ready infrastructure for building AI agents that interact with the Solana blockchain ecosystem. The framework implements an event-driven architecture with plugin support, enabling automated trading, portfolio management, market data analysis, and web research capabilities.

### Core Capabilities

| Category | Description | Tools |
|----------|-------------|-------|
| 🤖 **Agent Engine** | Multi-LLM orchestration with advanced tool calling | OpenAI, Anthropic, xAI, Local |
| 🛠️ **Tool Registry** | Production-ready integrations with middleware | 15+ tools |
| 📡 **Event System** | Async pub/sub messaging for component communication | Real-time streaming |
| 🔌 **Plugin SDK** | Extensible architecture for custom tools | Entry point discovery |
| 💾 **Memory System** | Persistent conversation context with compression | SQLite-based |
| 🔒 **Security Layer** | Encrypted key management and validation | Fernet + OS keyring |

### Use Cases

- **Automated Trading**: Execute trades on Pump.fun and Jupiter DEX
- **Portfolio Management**: Monitor balances and transaction history
- **Market Research**: Real-time data from DexScreener
- **Web Intelligence**: Search and news aggregation
- **Transaction Automation**: Safety-controlled blockchain operations

---

## ⚡ Key Features

<div align="center">

### 🤖 Agent Architecture
| Feature | Description |
|---------|-------------|
| **Multi-LLM Support** | OpenAI, Anthropic, xAI, and local models |
| **Advanced Tool Calling** | Loop prevention and error recovery |
| **Event-Driven Design** | Async pub/sub messaging system |
| **Session Persistence** | SQLite-based conversation context |
| **Async Optimization** | uvloop integration for performance |

### 🛠️ Tool Ecosystem
| Feature | Description |
|---------|-------------|
| **15+ Production Tools** | Complete Solana ecosystem coverage |
| **Plugin Architecture** | Extensible with entry point discovery |
| **Middleware Pipeline** | Configurable logging, rate limiting, retries |
| **SDK Integration** | Programmatic agent construction |
| **Error Handling** | Structured error responses and recovery |

### 🔒 Security & Safety
| Feature | Description |
|---------|-------------|
| **Fernet Encryption** | AES-128 encryption for sensitive data |
| **OS Keyring Integration** | System-level credential storage |
| **Transaction Validation** | Pre-execution safety checks |
| **Rate Limiting** | Configurable request throttling |
| **Address Validation** | Solana address format verification |

</div>

---

## 🚀 Quick Start

### Installation

```bash
git clone https://github.com/prfagit/sam-framework
cd sam-framework
uv sync
```

### Setup Options

<details>
<summary><strong>🎯 Interactive Onboarding (Recommended)</strong></summary>

```bash
uv run sam onboard
```

**Configures:**
- LLM provider selection and API key setup
- Wallet private key import (encrypted storage)
- Environment configuration
- Tool enablement preferences

</details>

<details>
<summary><strong>⚙️ Manual Configuration</strong></summary>

Create `.env` file:
```bash
# Provider Selection
LLM_PROVIDER=openai

# API Keys
OPENAI_API_KEY=sk-your-key-here
ANTHROPIC_API_KEY=sk-ant-your-key-here
XAI_API_KEY=xai-your-key-here

# Security
SAM_FERNET_KEY=your-generated-key

# Optional Services
BRAVE_API_KEY=your-brave-search-key
```

</details>

<details>
<summary><strong>🔄 Provider Management</strong></summary>

```bash
# List available providers
sam provider list

# Switch providers
sam provider switch anthropic

# Test provider connection
sam provider test
```

</details>

### First Run

```bash
# Start interactive agent (CLI)
sam run

# Or with custom session
sam run --session trading_session
```

<details>
<summary><strong>🌐 Web Interface (Streamlit)</strong></summary>

```bash
# Launch the web interface
uv run streamlit run examples/streamlit_app/app.py

# Access at http://localhost:8501
```

**Web Features:**
- Real-time chat with streaming responses
- Live tool call visualization and event streaming
- Interactive settings, wallet, and tools pages
- Session management with conversation history
- Responsive design with custom styling

</details>

### Interactive Features

**Enhanced Status Display:**
- Real-time model and wallet information
- Context usage percentage (auto-compacts at 80%)
- Session statistics and performance metrics

**Available Commands:**
- `/help` - Show available commands
- `/tools` - List available tools
- `/config` - Show current configuration
- `/provider` - Manage LLM providers
- `/settings` - Interactive configuration editor
- `/clear-context` - Clear conversation context
- `/compact` - Compact conversation history
- ESC - Interrupt current operation
- Ctrl+C - Exit

---

## 🛠️ Tool Ecosystem

SAM provides 15+ production-ready tools organized by category:

### 💰 Wallet Operations

| Tool | Description | Parameters |
|------|-------------|------------|
| `get_balance` | Complete wallet overview | `address` (optional) |
| `transfer_sol` | Send SOL between addresses | `to_address`, `amount` |
| `get_token_data` | Token metadata and supply | `address` |

### 🚀 Pump.fun Trading

| Tool | Description | Parameters |
|------|-------------|------------|
| `pump_fun_buy` | Execute token purchases | `mint`, `amount`, `slippage` |
| `pump_fun_sell` | Sell tokens with percentage | `mint`, `percentage`, `slippage` |
| `get_pump_token_info` | Detailed token information | `mint` |
| `get_token_trades` | View trading activity | `mint` |

### 🌌 Jupiter DEX

| Tool | Description | Parameters |
|------|-------------|------------|
| `get_swap_quote` | Get swap quotes | `input_mint`, `output_mint`, `amount` |
| `jupiter_swap` | Execute token swaps | Quote parameters |

### 📊 Market Data

| Tool | Description | Parameters |
|------|-------------|------------|
| `search_pairs` | Search trading pairs | `query` |
| `get_token_pairs` | Get pairs for token | `address` |
| `get_solana_pair` | Detailed pair information | `pair_address` |
| `get_trending_pairs` | Trending pairs by volume | `chain` |

### 🌐 Web Intelligence

| Tool | Description | Parameters |
|------|-------------|------------|
| `search_web` | Search internet content | `query`, `count` |
| `search_news` | Search news articles | `query`, `count` |

### Usage Examples

```bash
"Buy 0.01 SOL worth of BONK on pump.fun"
"Sell 50% of my DOGE position"
"Get swap quote for 1 SOL to USDC on Jupiter"
"Check my wallet balance"
"Show trending pairs on DexScreener"
```

---

## 🏗️ Architecture

```
sam/
├── cli.py                 # Enhanced CLI with interactive features
├── core/
│   ├── agent.py          # Main SAMAgent with advanced tool calling
│   ├── builder.py        # AgentBuilder for modular construction
│   ├── llm_provider.py   # Multi-LLM provider abstraction
│   ├── memory.py         # SQLite-based conversation persistence
│   ├── tools.py          # Tool registry with middleware support
│   ├── events.py         # Event system for pub/sub messaging
│   └── middleware.py     # Tool middleware pipeline
├── integrations/         # Blockchain and service integrations
│   ├── solana/          # Native Solana RPC operations
│   ├── pump_fun.py      # Pump.fun trading interface
│   ├── jupiter.py       # Jupiter aggregator integration
│   ├── dexscreener.py   # Market data provider
│   └── search.py        # Web search via Brave API
├── config/               # Configuration management
│   ├── settings.py      # Environment and settings
│   ├── prompts.py       # System prompts and templates
│   └── config_loader.py # TOML/JSON configuration loader
├── utils/                # Security and utilities
│   ├── crypto.py        # Key encryption with Fernet
│   ├── secure_storage.py # OS keyring integration
│   ├── validators.py    # Input validation and safety
│   ├── rate_limiter.py  # Request throttling
│   └── connection_pool.py # RPC connection management
└── commands/             # CLI command modules
    ├── onboard.py       # Interactive setup wizard
    ├── providers.py     # LLM provider management
    ├── health.py        # System diagnostics
    └── maintenance.py   # Database maintenance
```

### Design Patterns

- **Event-Driven**: Async pub/sub system for component communication
- **Plugin Architecture**: Entry point discovery for extensibility
- **Middleware Pipeline**: Configurable tool execution pipeline
- **Builder Pattern**: Modular agent construction
- **Repository Pattern**: Data access abstraction

---

## 🔧 Configuration

SAM supports multiple configuration methods with automatic loading priority:

### Configuration Priority
1. **Environment Variables** (highest priority)
2. **TOML Configuration File** (`sam.toml`)
3. **`.env` File** (auto-loaded)
4. **Interactive Settings** (runtime configuration)
5. **Sensible Defaults** (lowest priority)

### LLM Provider Configuration

| Provider | Environment Variables | Models |
|----------|----------------------|--------|
| **OpenAI** | `OPENAI_API_KEY`, `OPENAI_MODEL`, `OPENAI_BASE_URL` | GPT-4, GPT-3.5 |
| **Anthropic** | `ANTHROPIC_API_KEY`, `ANTHROPIC_MODEL`, `ANTHROPIC_BASE_URL` | Claude 3 |
| **xAI** | `XAI_API_KEY`, `XAI_MODEL`, `XAI_BASE_URL` | Grok |
| **Local** | `LOCAL_LLM_BASE_URL`, `LOCAL_LLM_MODEL` | Ollama, LM Studio |
| **OpenAI Compat** | `LOCAL_LLM_BASE_URL`, `LOCAL_LLM_MODEL` | Custom endpoints |

### TOML Configuration

```toml
# sam.toml
[llm]
provider = "anthropic"
model = "claude-3-5-sonnet-latest"

[safety]
max_transaction_sol = 5.0
default_slippage = 2.0

[tools]
enable_solana_tools = true
enable_pump_fun_tools = true
enable_jupiter_tools = true
enable_dexscreener_tools = true
enable_search_tools = false
```

### Middleware Configuration

```json
{
  "logging": {
    "include_args": false,
    "include_result": false,
    "only": [],
    "exclude": []
  },
  "rate_limit": {
    "enabled": true,
    "map": {
      "search_web": {"type": "search", "identifier_field": "query"},
      "pump_fun_buy": {"type": "pump_fun_buy", "identifier_field": "mint"}
    }
  },
  "retry": [
    {"only": ["search_web"], "max_retries": 2, "base_delay": 0.25}
  ]
}
```

---

## 🔌 Plugin System

SAM supports external tools via Python entry points:

### Entry Point Registration

```python
# setup.py or pyproject.toml
[project.entry-points."sam.plugins"]
my_trading_tools = "my_package.tools:register"

[project.entry-points."sam.llm_providers"]
custom_llm = "my_package.llm:create_provider"

[project.entry-points."sam.memory_backends"]
redis_memory = "my_package.memory:create_backend"
```

### Custom Tool Implementation

```python
# my_trading_tools.py
from sam.core.tools import Tool

async def arbitrage_scanner(args: dict) -> dict:
    """Scan for arbitrage opportunities."""
    return {
        "success": True,
        "opportunities": [],
        "timestamp": "2024-01-01T12:00:00Z"
    }

def register(registry, agent=None):
    registry.register(Tool(
        name="arbitrage_scanner",
        description="Scan for arbitrage opportunities across DEXs",
        input_schema={
            "type": "object",
            "properties": {
                "min_profit_percent": {"type": "number", "default": 1.0}
            }
        },
        handler=arbitrage_scanner
    ))
```

### Plugin Loading

```bash
# Load custom plugins
export SAM_PLUGINS="my_package.tools,vendor.tools"

# Use custom memory backend
export SAM_MEMORY_BACKEND="my_package.memory:create_backend"
```

---

## 🛡️ Security

### Key Management

SAM implements multiple layers of security for key management:

| Method | Description | Use Case |
|--------|-------------|----------|
| **OS Keyring** | System-level credential storage | Production deployments |
| **Fernet Encryption** | AES-128 encryption for keys | Secure storage |
| **Environment Variables** | Runtime configuration | Development |

### Security Features

- **Transaction Validation**: Pre-execution safety checks
- **Slippage Protection**: Configurable slippage tolerance
- **Rate Limiting**: Request throttling and abuse prevention
- **Address Validation**: Solana address format verification
- **Audit Logging**: Tool execution and error tracking

### Production Security Settings

```bash
# Security configuration
RATE_LIMITING_ENABLED=true
MAX_TRANSACTION_SOL=5.0
DEFAULT_SLIPPAGE=2.0
LOG_LEVEL=WARNING

# Key management
sam key import  # Secure key import
sam key generate  # Generate encryption keys
```

---

## 📊 Development

### Testing

```bash
# Run test suite
uv run pytest tests/ -v

# Run specific tests
uv run pytest tests/test_tools.py
uv run pytest tests/test_integration.py

# Run with coverage
uv run pytest tests/ --cov=sam --cov-report=html
```

### Code Quality

```bash
# Format code
uv run ruff format

# Check style and fix issues
uv run ruff check --fix

# Type checking
uv run mypy sam/
```

### Development Commands

```bash
# Interactive development
sam debug                    # Show plugins and middleware
sam provider test           # Test LLM provider
sam health                  # System diagnostics
sam settings               # Runtime configuration
```

### SDK Usage

```python
import asyncio
from sam.core.builder import AgentBuilder

async def main():
    agent = await AgentBuilder().build()

    # Direct tool calls
    result = await agent.tools.call("get_balance", {"address": "..."})
    print(result)

    # Headless agent
    response = await agent.run("Check my SOL balance", session_id="sdk")
    print(response)

asyncio.run(main())
```

---

## 📚 Documentation

- **[📖 Architecture Guide](https://sam.prfa.me/docs/architecture)** - System design and components
- **[🛠️ Tools Reference](https://sam.prfa.me/docs/tools)** - Complete tool documentation
- **[🔧 Configuration Guide](https://sam.prfa.me/docs/configuration)** - Setup and configuration options
- **[📋 CLI Reference](https://sam.prfa.me/docs/cli-reference)** - Command-line interface documentation
- **[🛡️ Security Guide](https://sam.prfa.me/docs/security)** - Security features and best practices
- **[🚀 Getting Started](https://sam.prfa.me/docs/getting-started)** - Step-by-step setup guide
- **[📊 API Reference](https://sam.prfa.me/docs/api-reference)** - SDK and API documentation

### Examples

- **`examples/plugins/`** - Plugin development examples
- **`examples/sdk/`** - SDK integration patterns
- **`tests/`** - Comprehensive test suite

---

## 📄 License

**MIT License** - See [LICENSE](LICENSE) for details.

## 🤝 Contributing

Contributions welcome. See [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

## 👥 Authors

**[@prfa](https://twitter.com/prfa)** • **[@prfagit](https://github.com/prfagit)** • **[prfa.me](https://prfa.me)**

---

<div align="center">

**SAM Framework** - Production-ready AI agent infrastructure for Solana blockchain operations.

[![GitHub](https://img.shields.io/badge/GitHub-Repository-black.svg)](https://github.com/prfagit/sam-framework)
[![Documentation](https://img.shields.io/badge/Documentation-Complete-blue.svg)](https://sam.prfa.me/docs/)

*Built for developers who value technical excellence and production reliability.*

</div>
